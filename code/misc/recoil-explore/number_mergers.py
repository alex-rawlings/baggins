import numpy as np
from astropy.units import Unit
from scipy.integrate import trapezoid
import baggins as bgs


# merger rate per galaxy from O'Leary 2021
'''data = np.array([
    [0.019383064739436233, 0.06062345524743358],
    [0.08583928670321761, 0.06069307019818064],
    [0.1554284448452915, 0.05671018000599599],
    [0.22504133735235246, 0.05580628626031328],
    [0.2914817364061425, 0.05397360488757415],
    [0.36425129945648305, 0.052206814801666244],
    [0.4275192050570021, 0.04962513560278291],
    [0.4749721121211402, 0.047979708302644614],
    [0.5287620946368247, 0.04720206821393754],
    [0.5825441656975134, 0.04564197131622578],
    [0.6299970727616516, 0.044128614330423706],
    [0.6837554094573534, 0.0405157122500458],
    [0.7438903788795799, 0.04126430076851746],
    [0.8198324353831913, 0.04061103479477571],
    [0.8894215935252652, 0.03794599755657991],
    [0.9779745092920039, 0.0336767459946601],
    [1.0064320129114945, 0.031992159220944796],
])'''

data = np.array([
    [0.03214285714285714, 0.0042470210699944],
    [0.06071428571428572, 0.0034922123941341972],
    [0.10357142857142854, 0.003231283031522575],
    [0.15357142857142847, 0.002932158886771794],
    [0.1785714285714285, 0.002364016852402281],
    [0.22142857142857142, 0.002022246114943171],
    [0.2857142857142857, 0.0015383803272786987],
    [0.35, 0.0015708486184699666],
    [0.4035714285714286, 0.0014255329913998335],
    [0.45000000000000007, 0.001105547778480822],
    [0.5107142857142856, 0.0008746257115902645],
    [0.5928571428571429, 0.0007199379195354823],
    [0.6571428571428571, 0.0006931025294115104],
    [0.7642857142857141, 0.0006548509340346287],
    [0.7999999999999997, 0.0005940639492788239],
    [0.8714285714285716, 0.0006066870035106917],
    [0.9214285714285714, 0.0005954812627589828],
    [0.957142857142857, 0.0006077083603297764],
    [1.0035714285714286, 0.0005734858771250684],
])


z = data[:,0]
mask = z < 1.01

z = z[mask]
Rz = data[mask,1] * Unit("1/Gyr")


N_merger_per_gal = trapezoid(Rz / ((1+z)*bgs.cosmology.Hubble_parameter(z)))

print(f"Number of mergers per galaxy: {N_merger_per_gal:.3e}")

N_gal = 960 #108891#960# 1827761  # from SDSS
print(f"There are {N_gal:.2e} galaxies")
N_mergers = N_merger_per_gal * N_gal

print(f"There are {N_mergers:.3e} expected mergers")